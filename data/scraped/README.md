# MOA Appointments Data Scraping

## Quick Start Guide

### Step 1: Save the Rendered HTML (30 seconds)

1. **Open the appointments page in your browser:**
   - Visit: https://www.nyc.gov/content/appointments/pages/boards-commissions

2. **Wait for content to load:**
   - Scroll to the bottom of the page to ensure all accordion cards are loaded
   - You should see all boards and commissions listed

3. **Save the complete page:**
   - **macOS:** Press `Cmd+S` or Right-click → "Save Page As..."
   - **Windows/Linux:** Press `Ctrl+S` or Right-click → "Save Page As..."
   - Choose format: "Webpage, Complete" or "HTML Only"
   - Save location: This directory (`data/scraped/`)
   - Filename: `appointments_page.html`

### Step 2: Run the Parser

From the project root directory, run:

```bash
python scripts/data_collection/scrape_moa_appointments_from_html.py
```

### Expected Output

The script will create:
- **File:** `data/scraped/moa_appointments_raw.csv`
- **Contents:** All boards and commissions with:
  - Entity name
  - Description
  - URL (if available)
  - Scraped date
  - Source URL

### Next Steps

After successful parsing, run:

1. **Crosswalk creation:**
   ```bash
   python scripts/data_collection/create_moa_crosswalk.py
   ```
   - Matches MOA entities to existing NYCGO dataset
   - Uses fuzzy name matching
   - Output: `data/crosswalk/moa_to_nycgo_mapping.csv`

2. **Gap analysis:**
   ```bash
   python scripts/analysis/analyze_moa_coverage.py
   ```
   - Identifies entities in MOA but not NYCGO
   - Identifies entities in NYCGO but not MOA
   - Output: `data/analysis/moa_coverage_gaps.csv`

## Troubleshooting

### "HTML file not found" Error

Make sure you saved the file to the correct location:
- Path: `data/scraped/appointments_page.html`
- The file must be in the `scraped` subdirectory, not the project root

### "No entities extracted" Error

This usually means:
1. The page wasn't fully loaded when you saved it
   - Solution: Reload the page, wait longer, scroll to bottom, then save again

2. The HTML structure has changed
   - Solution: Check SCRAPING_NOTES.md for updated selectors

### How to verify the HTML file is correct

Open `appointments_page.html` in a browser - you should see all the boards and commissions listed with their descriptions.

## Files in This Directory

- `README.md` - This file
- `SCRAPING_NOTES.md` - Technical notes about scraping approach
- `moa_appointments_TEMPLATE.csv` - Example of expected output format
- `appointments_page.html` - (You need to create this) Saved HTML from browser
- `moa_appointments_raw.csv` - (Generated by parser) Extracted entity data

## Why Not Fully Automated?

The appointments page uses JavaScript to load content dynamically. While we could use browser automation (Playwright), it encounters permission issues on macOS. The hybrid approach (manual save + automated parsing) is:

- ✅ More reliable across different environments
- ✅ Faster (no browser startup time)
- ✅ Gives you control to verify content loaded correctly
- ⚠️ Requires one 30-second manual step

This is a one-time task - once the CSV is created, all subsequent processing is fully automated.
